@using WebDriverViolation.Models.Models.MasterModels;
@inject UserManager<AspNetUser> userManager
@inject SignInManager<AspNetUser> SignInManager
@inject WebDriverViolation.Services.Contracts.IUserViolationNotificationService _userViolationNotificationService
@inject WebDriverViolation.Services.Contracts.IEmployeeService _employeeService
@inject WebDriverViolation.Services.Contracts.IViolationTypeService _violationTypeService;
@{
    var user = await userManager.GetUserAsync(User);
    var displayName = user.UserName;
    var roles = await userManager.GetRolesAsync(user);
    var notifications = @_userViolationNotificationService.GetUserViolationNotification(user.Id);
    int NotificationCount = 0;
    var ViolationTypes = await _violationTypeService.GetAllViolationTypes();
    Employee employee = await _employeeService.GetEmployeeByUserId(user.Id);
    //var stepTwoRequestModels = _tripJobsiteService.GetPendingStepTwoRequests();
    //if(stepTwoRequestModels != null)
    //{
    //    PendingRequestsCount = stepTwoRequestModels.Count;
    //}

        if (notifications != null)
        {
            NotificationCount = notifications.Where(n => n.Seen == false).Count();
            notifications = notifications.Take(50).OrderByDescending(n => n.CreatedDate).ToList();
        }
    }
   @if (SignInManager.IsSignedIn(User))
    {
<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Driver Violation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="~/Strdash/assets/images/icon/favicon.ico">
    <link rel="stylesheet" href="~/Strdash/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/Strdash/assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="~/Strdash/assets/css/themify-icons.css">
    <link rel="stylesheet" href="~/Strdash/assets/css/owl.carousel.min.css">
    <!-- amcharts css -->
    <!-- Start datatable css -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.18/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.jqueryui.min.css">
    <!-- style css -->
    <link rel="stylesheet" href="~/Strdash/assets/css/typography.css">
    <link rel="stylesheet" href="~/Strdash/assets/css/default-css.css">
    <link rel="stylesheet" href="~/Strdash/assets/css/styles.css">
    <link rel="stylesheet" href="~/Strdash/assets/css/responsive.css">
    <!-- modernizr css -->
    <script src="~/Strdash/assets/js/vendor/modernizr-2.8.3.min.js"></script>
</head>

<body class="body-bg">
    <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <!-- preloader area start -->
    <div id="preloader">
        <div class="loader"></div>
    </div>
    <!-- preloader area end -->
    <!-- main wrapper start -->
    <div class="horizontal-main-wrapper">
        <!-- main header area start -->
        <div class="mainheader-area">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="logo">
                            <a asp-controller="Home" asp-action="Index"><h3>Driver Violation</h3></a>
                        </div>
                    </div>
                        <div class="col-md-6 clearfix text-right">
                            <div class="d-md-inline-block d-block mr-md-4">
                                <ul class="notification-area">
                                    <li id="full-view"><i class="ti-fullscreen"></i></li>
                                    <li id="full-view-exit"><i class="ti-zoom-out"></i></li>
                                    <li class="dropdown" id="notificationGroup">
                                        <i class="ti-bell dropdown-toggle" data-toggle="dropdown"><span id="notificationCount1">@NotificationCount</span></i>
                                        <div class="dropdown-menu notify-box nt-enveloper-box" style="height:300px; overflow-y: scroll">
                                            <span class="notify-title">You have <span id="notificationCount">@NotificationCount</span> new notifications</span>
                                             <div class="nofity-list"  id="test">
                                                 @if (notifications != null)
                                                {
                                                        @foreach (var notification in notifications)
                                                        {
                                                            <a onclick="showViolationDetails(@notification.ViolationNotification.ViolationID, @JsonSerializer.Serialize(ViolationTypes), 0)" class="notify-item">
                                                           @*      <div class="notify-thumb">
                                                                    <img src="~/images/alert.png" alt="alert" />
                                                                </div> *@
                                                                <div class="notify-text pl-2">
                                                                    <p style="font-weight:bold"><i class="fa fa-warning " style="color:red; padding-right:5px"></i>@notification.ViolationNotification.Violation.ViolationType.Name</p>
                                                                    <hr />
                                                                    <span class="msg">@notification.ViolationNotification.Message</span>
                                                                    <span></span>
                                                                </div>
                                                            </a>
                                                        }
                                                }
                                             </div>
                                         </div>
                                    </li>
                                </ul>
                            </div>
                            <div class="clearfix d-md-inline-block d-block">
                                <div class="user-profile m-0">
                                    <img class="avatar user-thumb" src="~/Strdash/assets/images/author/avatar.png" alt="avatar">
                                    <h4 class="user-name dropdown-toggle" data-toggle="dropdown"> @employee.EmployeeName <i class="fa fa-angle-down"></i></h4>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item" href="/DriverViolation/Identity/Account/logout">Log Out</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
        <input type="hidden" id="userId" value="@employee.UserId" />
            <audio id="myAudio" controls hidden>
                <source src="~/sound/notify.mp3" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
            <div class="header-area header-bottom">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-lg-9  d-none d-lg-block">
                            <div class="horizontal-menu">
                                <nav>
                                    <ul id="nav_menu">
                                        <li>
                                            <a asp-controller="Home" asp-action="Index">
                                                <i class="bi bi-house"></i> <span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                                                        <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z" />
                                                    </svg> Dashboard
                                                </span>
                                            </a>
                                        </li>
                                        <li><a asp-controller="Violation" asp-action="SearchViolation"><i class="ti-search"></i> <span>Search violations</span></a></li>
                                        <li><a asp-controller="TruckTracking" asp-action="SearchTruckTracking"><i class="ti-map-alt"></i> <span>Search Trucks</span></a></li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                        <!-- nav and search button -->
                        <div class="col-lg-3 clearfix">
 
                        </div>
                        <!-- mobile_menu -->
                        <div class="col-12 d-block d-lg-none">
                            <div id="mobile_menu"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="main-content-inner">
                <div class="container">
                    @RenderBody()
                </div>
            </div>
            <div class="content-wrapper">
                <div class="modal fade" id="ViolationNotificationModal" tabindex="-1" role="dialog" aria-labelledby="requestModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="requestModalLabel">Violation Details</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="clearElements()">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col col-lg-12 mb-2 mb-lg-0">
                                        <div class="card mb-1" style="border-radius: .5rem; padding:10px">
                                            <div class="card-header p-2">
                                                <ul class="nav nav-pills">
                                                    <li class="nav-item"><a class="nav-link active" href="#info" data-toggle="tab">Details</a></li>
                                                    <li class="nav-item"><a class="nav-link" href="#Confirmation" data-toggle="tab">Confirmation</a></li>
                                                    <li class="nav-item"><a class="nav-link text-danger" href="#Rejection" data-toggle="tab">Rejection</a></li>
                                                </ul>
                                            </div><!-- /.card-header -->
                                            <div class="card-body p-1">
                                                <div class="tab-content">
                                                    <div class="active tab-pane" id="info">
                                                       
                                                        <span id="confirmedOrNot" style="display:none"></span>
@*                                                         <div class="row pt-1">
 *@                                                         <div class="row mb-1 mt-3">
                                                                <div class="col-lg-6 mb-1">
                                                                <h6>Truck Number </h6>
                                                                </div>
                                                                <div class="col-lg-4 mb-1">
                                                                <label class="text-muted" id="ViolationTruckID"></label>
                                                                </div>
                                                            </div>
                                                            <div class="row mb-1">
                                                            <div class="col-lg-6 mb-1">
                                                                <h6>Suggested Type </h6>
                                                                </div>
                                                            <div class="col-lg-4 mb-1">
                                                                <label class="text-muted" id="ViolationType"></label>
                                                                </div>
                                                            </div>
                                                            <div class="row mb-1">
                                                                <div class="col-lg-6 mb-1">
                                                                       <h6>Probability </h6>
                                                                  </div>
                                                                <div class="col-lg-4 mb-1">
                                                                        <label class="text-muted" id="Confidence"></label>
                                                                </div>
                                                            </div>
                                                            <div class="row mb-1">
                                                            <div class="col-lg-6 mb-1">
                                                                <h6>Average Probability</h6>
                                                                </div>
                                                            <div class="col-lg-4 mb-1">
                                                                <label class="text-muted" id="AverageConfidence"></label>
                                                                </div>
                                                            </div>

                                                            <div class="row  mb-1">
                                                            <div class="col-lg-6 mb-1">
                                                                <h6>Date </h6>
                                                                </div>
                                                            <div class="col-lg-6 mb-1">
                                                                <label class="text-muted" id="ViolationDate"></label>
                                                                </div>
                                                            </div>

                                                            <div class="row mb-1">
                                                            <div class="col-lg-6 mb-1">
                                                                <h6>Accuracy Level</h6>
                                                            </div>
                                                            <div class="col-lg-4 mb-1">
                                                                <label class="text-muted" id="AccuracyLevel"></label>
                                                                </div>
                                                            </div>

@*                                                         </div>
 *@                                                        <div class="row pt-1">
                                                            <div class="col-lg-12 mb-1" style="height:fit-content">
                                                                <img src="" style="width: 100%; height:100% " id="ViolationImageID">
                                                                <input type="hidden" id="violationImgs" value="" />
                                                                <input type="hidden" id="violationProbabilities" value="" />
                                                                <input id="currentViolationImgsNumber" type="hidden" />
                                                            </div>
                                                        </div>
                                                        <div class="row p-3" style="margin:auto">
                                                            <div class="col-lg-12 mb-1" >
                                                                <div id="arrowButtons">
                                                                    <button id="previousImg" class="btn btn-primary" onclick="changeImage('down')">Previous</button>||
                                                                    <button id="NextImg" class="btn btn-primary" onclick="changeImage('up')">Next</button>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="tab-pane" id="Confirmation">
                                                        
                                                        <div class="row mt-3">
                                                            <div class="col-lg-6 mb-1">
                                                                <h6 class="control-label model-label">Confirmation Status </h6>
                                                                </div>
                                                            <div class="col-lg-6 mb-1">
                                                                <label class="text-muted" id="ConfirmationStatusId"></label>
                                                                </div>
                                                            </div>
                                                        <div class="row pt-1">
                                                            <div class="col-lg-6 mb-1">
                                                                <h6>Suggested Type </h6>
                                                                </div>
                                                            <div class="col-lg-6 mb-1">
                                                                <label class="text-muted" id="SuggestedType"></label>
                                                            </div>
                                                        </div>
                                                        <div class="row pt-1" id="NeedConfirmation">
                                                            <div class="col-lg-6 mb-1">
                                                                <h6>Confirmed Type </h6>
                                                            </div>
                                                            <div class="col-lg-6 mb-1">
                                                                <select class="form-control select2bs4" style="width: 100%;" id="ConfirmedTypeList">
                                                                </select>
                                                            </div>
                                                      
                                                            <div class="col-lg-6 mb-1" id="ConfirmationButton">
                                                                <label hidden id="violationId"></label>
                                                                <button type="button" class="btn btn-success" onclick="addNewConfirmation()">Submit</button>
                                                            </div>
                                                        </div>
                                                        <div class="row pt-1" id="ConfirmationBy">
                                                            <div class="col-lg-6 mb-1">
                                                                <h6 class="control-label model-label">Confirmed Type </h6>
                                                                </div>
                                                            <div class="col-lg-6 mb-1">
                                                                <label class="text-muted" id="ConfirmedTypeId"></label>
                                                                </div>
                                                   
                                                            <div class="col-lg-6 mb-1">
                                                                <h6 class="control-label model-label">Confirmation By </h6>
                                                                </div>
                                                            <div class="col-lg-6 mb-1">
                                                                <label class="text-muted" id="ConfirmationById"></label>
                                                                </div>
                                                          
                                                            <div class="col-lg-6 mb-1">
                                                                <h6 >Confirmation Date </h6>
                                                                </div>
                                                            <div class="col-lg-6 mb-1">
                                                                <label class="text-muted" id="ConfirmedDate"></label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                 
                                                    <div class="tab-pane" id="Rejection" style="min-height:100px">
                                                        <div id="RejectionButtonDiv" class="d-flex justify-content-center pt-8">
                                                            <button type="button" id="RejectionButton" class="btn btn-danger btn-lg" style="display:none" onclick="addRejection()">
                                                                <i class="fa fa-trash"></i>
                                                            </button>
                                                            <Span id="RejectionText" class="text-lg" style="display:none">Rejected</Span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="clearElements()">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <footer>
                <div class="footer-area">
                    <p>© Copyright Cemex 2024. All right reserved</p>
                </div>
            </footer>
            <!-- footer area end-->
        </div>
        <!-- main wrapper start -->
        <!-- offset area start -->
        <!-- offset area end -->
        <!-- jquery latest version -->
        <script src="~/Strdash/assets/js/vendor/jquery-2.2.4.min.js"></script>
        <!-- bootstrap 4 js -->
        <script src="~/Strdash/assets/js/popper.min.js"></script>
        <script src="~/Strdash/assets/js/bootstrap.min.js"></script>
        <script src="~/Strdash/assets/js/owl.carousel.min.js"></script>
        <script src="~/Strdash/assets/js/metisMenu.min.js"></script>
        <script src="~/Strdash/assets/js/jquery.slimscroll.min.js"></script>
        <script src="~/Strdash/assets/js/jquery.slicknav.min.js"></script>


        <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>
        <script src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.18/js/dataTables.bootstrap4.min.js"></script>
        <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
        <script src="https://cdn.datatables.net/responsive/2.2.3/js/responsive.bootstrap.min.js"></script>
        <!-- others plugins -->
        <script src="~/Strdash/assets/js/plugins.js"></script>
        <script src="~/Strdash/assets/js/scripts.js"></script>
        <script src="~/js/JQuery/jquery.timeago.js"></script>
        <script src="~/lib/aspnet-signalr/signalr.js"></script>
        <script src="~/js/site.js"></script>
        <script src="~/js/sweetalert.min.js"></script>
        <script>
                $(document).ready(function () 
                {
                    $('#notificationGroup').click(function () {
                        var url = '@Url.Content("~/")' + "Home/updateSeenNotification";
                        $.getJSON(url, function (data)
                        {
                            if (data == true) {
                                document.getElementById("notificationCount1").innerText = 0;
                            }
                        });
                    });
                });
                // $(function () 
                // {
                //     $("#example1").DataTable({
                //         "responsive": true, "lengthChange": false, "autoWidth": false,
                //         "buttons": ["excel"]
                //     }).buttons().container().appendTo('#example1_wrapper .col-md-6:eq(0)');
                // });

            </script>
            <script>
    function clearElements() {
        $(".TimeInfo").remove();
                var cancelBlock = document.getElementById("RejectionButton");
        if (cancelBlock != null) {
           // cancelBlock.remove();
        }
        var requestWhoApprovedDiv = document.getElementById("requestWhoApprovedDiv");
        if (requestWhoApprovedDiv != null) {
            requestWhoApprovedDiv.style.display = 'none';
        }
        var responseDateDiv = document.getElementById("responseDateDiv");
        if (responseDateDiv != null) {
            responseDateDiv.style.display = 'none';
        }

        var requestData = document.getElementById("requestData");
        if (requestData != null) {
            requestData.style.display = 'none';
        }
        var warningBlock = document.getElementById("warningBlock");
        if (warningBlock != null) {
            warningBlock.style.display = 'none';
        }
        document.getElementById("warnTitle").setAttribute("style", "color:black");
    }

      function showViolationDetails(id, TypesList, confirmButtonId)
        {
                var url = '@Url.Content("~/")' + "Violation/getViolationDetails";
                        $.getJSON(url, { violationId: id }, function (data) 
                        {
                            if (data != null) 
                            {
                               // alert(data["PriobabilityOfViolationsWithSameCode"]);
                                document.getElementById("violationImgs").innerText = data["images"];
                                document.getElementById("currentViolationImgsNumber").innerText = 0;
                                document.getElementById("AccuracyLevel").innerText = data["ViolationAccuracyLevelDescription"];
                                document.getElementById("confirmedOrNot").innerText = confirmButtonId;
                                document.getElementById("ViolationTruckID").innerText = data["TruckID"];
                                document.getElementById("ViolationType").innerText = data["ViolationType"]["Name"];
                                document.getElementById("ViolationDate").innerText = new Date(data["Date"]).toLocaleString('en-US');
                                document.getElementById("ViolationImageID").src = data["images"][0];
                                document.getElementById("ConfirmationStatusId").innerText = data["ConfirmationStatus"]["Name"];
                                document.getElementById("SuggestedType").innerText = data["ViolationType"]["Name"];
                               document.getElementById("Confidence").innerText = data["PriobabilityOfViolationsWithSameCode"][0];
                               document.getElementById("violationProbabilities").innerText = data["PriobabilityOfViolationsWithSameCode"];
                               document.getElementById("AverageConfidence").innerText = data["AverageProbability"];
                                document.getElementById("violationId").textContent = data["Id"];
                                if (data["ConfirmationStatus"]["Name"] == "Pending") 
                                {
                                    document.getElementById("ConfirmationBy").style.display = 'none';
                                    document.getElementById("NeedConfirmation").style.display = '';
                                   document.getElementById("RejectionButton").style.display = '';
                                  document.getElementById("RejectionText").style.display = 'none';
                                    var TypesDD = document.getElementById("ConfirmedTypeList");
                                    if (TypesList.length > 0) 
                                    {
                                        for(var index =0; index<TypesList.length; index++)
                                        {
                                            var op = document.createElement('option');
                                            op.text = TypesList[index].Name;
                                            op.value = TypesList[index].ID;
                                            if (TypesList[index].Text == data["ViolationType"]["Name"])
                                            {
                                                op.selected = true;
                                            }
                                            TypesDD.options[index] = op;
                                        }
                                    }
                                 }
                                    else if (data["ConfirmationStatus"]["Name"] == "Confirmed") 
                                    {
                                        document.getElementById("ConfirmationBy").style.display = '';
                                        document.getElementById("NeedConfirmation").style.display = 'none';
                                        document.getElementById("ConfirmedTypeId").innerText = data["ConfirmationViolationTypeName"];
                                        document.getElementById("ConfirmationById").innerText = data["ConfirmedByUserName"];
                                        document.getElementById("ConfirmedDate").innerText = data["ConfirmationDate"];
                                        if (data["ConfirmationViolationTypeName"] =="Rejected")
                                        {
                                            document.getElementById("RejectionButton").style.display = 'none';
                                            document.getElementById("RejectionText").style.display = '';
                                            document.getElementById("ConfirmedTypeId").style.color='red';
                                        }
                                        else
                                        {
                                            document.getElementById("ConfirmedTypeId").style.color = 'green';
                                            document.getElementById("RejectionText").style.display = '';
                                           document.getElementById("RejectionText").innerText = "No Rejection";
                                           document.getElementById("RejectionText").style.color = 'black';
                                          document.getElementById("RejectionButton").style.display = 'none';
                                        }
                                    }
                                 $('#ViolationNotificationModal').modal('show');
                             }
                       });
                   }

            function changeImage(status)
            {
                var currentImgIndex = parseInt(document.getElementById("currentViolationImgsNumber").innerText);
                var newIndex = 0;
                var images =    document.getElementById("violationImgs").innerText.split(",");
                var probabilities = document.getElementById("violationProbabilities").innerText.split(",");
                if(status =="up")
                {
                    if(currentImgIndex == 2)
                    {
                        document.getElementById("ViolationImageID").src =images[newIndex];
                        document.getElementById("Confidence").innerText = probabilities[newIndex];
                    }
                    else
                    {
                        newIndex = currentImgIndex + 1;
                        document.getElementById("ViolationImageID").src = images[newIndex];
                        document.getElementById("Confidence").innerText = probabilities[newIndex];
                        document.getElementById("currentViolationImgsNumber").innerText = newIndex;

                    }
                }
                else if(status =="down")
                {
                     if(currentImgIndex == 0)
                    {
                        document.getElementById("ViolationImageID").src =images[2];
                        document.getElementById("Confidence").innerText = probabilities[2];
                    }
                    else
                    {
                        newIndex = currentImgIndex - 1;
                        document.getElementById("ViolationImageID").src = images[newIndex];
                        document.getElementById("Confidence").innerText = probabilities[newIndex];
                        document.getElementById("currentViolationImgsNumber").innerText = newIndex;
                    }
                }
            }

      function addRejection()
      {
            var Confirmdata =
            {
                selectedTypeId : document.getElementById("ConfirmedTypeList").value,
                Id: document.getElementById("violationId").textContent,
            };
            $.ajax(
                {
                    url: '@Url.Content("~/")' + "Violation/RejectViolation",
                    data: Confirmdata,
                    type: "POST",
                    async: false,
                    success: function (data) 
                    {
                        swal("Success Process", 
                        {
                            icon: "success",
                            Text: "Successful Process"
                        });
                            var url = '@Url.Content("~/")' + "Home/getPendingViolationsCount";
                            $.getJSON(url, function (data) 
                            {
                                document.getElementById("pendingViolationCountId").innerText = data;
                            });
                            var buttonId = document.getElementById("confirmedOrNot").innerText;
                            if(buttonId != 0)
                            {
                               document.getElementById(buttonId).cells[3].innerHTML = "<b style='color:red'>Rejected</b>";
                            }
                    },
                    error: function () 
                    {
                        swal("Failed process",
                            {
                                icon: "error",
                            });
                    }

            });
            $('#ViolationNotificationModal').modal('toggle');
      }

      function addNewConfirmation() {
                var Confirmdata =
                {
                    selectedTypeId: document.getElementById("ConfirmedTypeList").value,
                    Id: document.getElementById("violationId").textContent,
                };
                $.ajax(
                    {
                        url: '@Url.Content("~/")' + "Violation/AddConfirmationData",
                        data: Confirmdata,
                        type: "POST",
                        async: false,
                        success: function (data) {
                            swal("Success Process",
                                {
                                    icon: "success",
                                });
                            var url = '@Url.Content("~/")' + "Home/getViolationStats";
                            $.getJSON(url, function (data) {
                                if (data != null) 
                                {
                                   
                                    document.getElementById("pendingViolationCountId").innerText = data['PendingViolationCount'];
                                    document.getElementById("thisMonthActualCountId").innerText = data['CurrentMonthActualViolationCount'];
                                    document.getElementById("totalActualCountId").innerText = data['TotalActualViolationCount'];
                                    for (var index = 0; index < data["ViolationTypeCounts"].length; index++) 
                                    {
                                        document.getElementById(data['ViolationTypeCounts'][index]["ViolationTypeName"]).innerText = data['ViolationTypeCounts'][index]["Count"];
                                    }
                                }
                            });
                            var buttonId = document.getElementById("confirmedOrNot").innerText;
                            if (buttonId != 0)
                            {
                                document.getElementById(buttonId).cells[4].innerHTML = "<b style='color:green'>Confirmed</b>";
                            }
                            document.getElementById("RejectionText").innerText = "No Rejection";
                        },
                        error: function () {
                            swal("Failed process",
                                {
                                    icon: "error",
                                });
                        }

                    });
                $('#ViolationNotificationModal').modal('toggle');
            }
            </script>
        </body>
        @RenderSection("Scripts", required: false)
    </html>
    }